<project name="YaSchoolResume" default="release" basedir=".">
	<property name="build" location="build-resume"/>

	<property environment="env"/>
	<property name="pageName" value="resume.html"/>
	<!--<property name="closurePath" value="env.CLOSURE_COMPILER"/>-->

	<target name="init">
		<!-- Create the time stamp -->
		<tstamp/>
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${build}"/>
		<mkdir dir="${build}/js"/>
		<mkdir dir="${build}/css"/>
		<mkdir dir="${build}/img"/>

		<copy file="${pageName}" tofile="${build}/${pageName}"/>

		<copy todir="${build}/css">
			<fileset dir="css"/>
			<fileset dir="top-jumper/css"/>
		</copy>

		<copy todir="${build}/img">
			<fileset dir="top-jumper/img"/>
		</copy>

		<copy todir="${build}/libs">
			<fileset dir="libs"/>
		</copy>

	</target>

	<target name="build" description="Concatenate all js files" depends="init">
		<concat destfile="${build}/application.js" fixlastline="yes" encoding="UTF-8">
			<filelist dir="js" files="Sandbox.js,Sandbox-Log.js"/>
			<filelist dir="top-jumper" files="top-jumper.js"/>

			<filelist dir="js" files="navigator.js, resume.js"/>
		</concat>

		<exec error="${build}/errors.txt" dir="${build}" executable="java" failonerror="true">
			<arg line="-jar '${env.CLOSURE_COMPILER}'/compiler.jar --compilation_level WHITESPACE_ONLY --formatting=pretty_print --js application.js --js_output_file js/application-compiled.js"/>
		</exec>

		<delete>
			<fileset dir="${build}" includes="application.js,errors.txt"/>
		</delete>
	</target>

<!--
	<target name="set_path">
		<replace dir="${build}" includes="*.html" value="." encoding="UTF-8">
			<replacetoken>{{PathToHtml}}</replacetoken>
		</replace>
	</target>
-->

	<target name="compile_templates">
		<concat destfile="${build}/templates.html" fixlastline="yes" encoding="UTF-8">
			<fileset dir="top-jumper/tmpl"/>
		</concat>

		<loadfile property="templates" srcFile="${build}/templates.html" encoding="UTF-8"/>

		<replace file="${build}/${pageName}" value="${templates}" encoding="UTF-8">
			<replacetoken>{{Templates}}</replacetoken>
		</replace>

		<delete>
			<fileset dir="${build}" includes="templates.html"/>
		</delete>
	</target>

	<target name="clean">
		<delete dir="${build}" />
	</target>

	<target name="release" depends="init, build, compile_templates"/>




	<!--
	<target name="clean" description="clean up" >
		<delete dir="${build}"/>
		<delete dir="${dist}"/>
	</target>
	-->
</project>